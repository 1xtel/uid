# k-ordered unique identity

The library provide interface to generate k-ordered unique id in lock-free and decentralized manner for Erlang application. The concept is similar to snowflake identity schema, however the library developed schema to ensure

  * 64-bit unique identity within virtual machine
  * 96-bit or 128-bit globally unique identity 

Client applications benefits from short 64-bit identity using it locally (e.g. standalone application) and dynamically switches schema while communicating with remote peers (clustered application). 

The library considers following aspects to generate k-order identifier:

* 32-bit represent (optionally 64-bit) unique node identifier allocated randomly to each node (derived as hash from long node name). Node id has higher priority during sorting then time-stamp, which allows to build reliable sorting without time synchronization.

* 50-bit time-stamp with millisecond resolution.

* 4-bit auto-increment sequence identifier. Each node maintain up to 16 sequences, the client process is sticked randomly to one of sequence. This allows to balance allocation workload to multiple parallel processes. This approach has a trade off. It is possible to order events generated by same process if they happens with sub-millisecond frequency but logical order of parallel independent events might be skewed.

It is possible to order set-

* 10-bit auto-increment sequence. The sequence is incremented only if multiple allocations happens same millisecond.

## 64-bit

```
        20bit          20bit        10bit     4bit    10bit
   |--------------|--------------|----------|------|----------|
          A              B             C       Id      Seq
   
   A, B, C - time stamp in milliseconds
   Id      - sequence identifier
   Seq     - sequence value 
```

## 96-bit

```
            32bit                         64bit                  
   |----------------------|-----------------------------------|
             Node                          Uid    
   
   Node = erlang:phash(erlang:node(), 1 bsl 32). 

```


## 128-bit

```
         48bit      16bit                 64bit                  
   |--------------|-------|-----------------------------------|
     MAC / Worker    Node                  Uid    
   
   Node = erlang:phash(erlang:node(), 1 bsl 16). 

```
   